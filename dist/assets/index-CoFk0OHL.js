(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=n(c);fetch(c.href,r)}})();let b=0,w=0;const L={I:{shape:[[1,1,1,1]],color:"#00f0f0"},L:{shape:[[1,0],[1,0],[1,1]],color:"#f0a000"},J:{shape:[[0,1],[0,1],[1,1]],color:"#0000f0"},T:{shape:[[1,1,1],[0,1,0]],color:"#a000f0"},O:{shape:[[1,1],[1,1]],color:"#f0f000"},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000"},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000"},Single:{shape:[[1]],color:"#f0a0f0"},Plus:{shape:[[0,1,0],[1,1,1],[0,1,0]],color:"#a0a0a0"},U:{shape:[[1,0,1],[1,1,1]],color:"#f0f0a0"}};let C=0,l=null;function A(){const e=document.getElementById("game-grid"),t=5;for(let n=0;n<t*t;n++){const o=document.createElement("div");o.className="grid-cell",o.dataset.index=n,e.appendChild(o)}}function $(e,t,n){const o=document.createElement("div");o.className="tetris-piece",o.id=`piece-${e}-${Date.now()}`;const c=document.createElement("div");c.className="piece-grid";let r=JSON.parse(JSON.stringify(t.shape));const s=Math.floor(Math.random()*4);for(let a=0;a<s;a++)r=Y(r);o.dataset.shape=JSON.stringify(r),o.dataset.color=t.color,D(c,r,t.color),o.appendChild(c),n.appendChild(o),o.setAttribute("draggable",!0),o.addEventListener("dragstart",P),o.addEventListener("dragend",ee)}function D(e,t,n){e.innerHTML="",e.style.display="grid",e.style.gridTemplateRows=`repeat(${t.length}, 10px)`,e.style.gridTemplateColumns=`repeat(${t[0].length}, 10px)`,t.forEach(o=>{o.forEach(c=>{const r=document.createElement("div");if(r.className="piece-cell",c){r.style.backgroundImage='url("./bubble.png")',r.style.backgroundSize="cover";const s=S(n);r.style.filter=`hue-rotate(${s}deg)`}e.appendChild(r)})})}function S(e){const t=H(e),n=X(t.r,t.g,t.b);return Math.round(n[0]*360)}function H(e){e=e.replace(/^#/,"");const t=parseInt(e,16),n=t>>16&255,o=t>>8&255,c=t&255;return{r:n,g:o,b:c}}function X(e,t,n){e/=255,t/=255,n/=255;const o=Math.max(e,t,n),c=Math.min(e,t,n);let r,s,a=(o+c)/2;if(o===c)r=s=0;else{const i=o-c;switch(s=a>.5?i/(2-o-c):i/(o+c),o){case e:r=(t-n)/i+(t<n?6:0);break;case t:r=(n-e)/i+2;break;case n:r=(e-t)/i+4;break}r/=6}return[r,s,a]}function Y(e){return e.length,e[0].map((n,o)=>e.map(c=>c[o]).reverse())}function I(){const e=document.getElementById("tetris-bank");e.innerHTML="";const t=5;for(let n=0;n<t;n++){const o=q();$(o.key,o.piece,e)}h()}function q(){const e=Object.keys(L),t=e[Math.floor(Math.random()*e.length)];return{key:t,piece:L[t]}}function J(e){const t=document.getElementById("tetris-bank"),n=q();e.remove(),$(n.key,n.piece,t),h()}function W(){document.querySelectorAll(".tetris-piece").forEach(t=>{t.addEventListener("mousedown",P),t.addEventListener("touchstart",P,{passive:!1})}),document.addEventListener("mousemove",R),document.addEventListener("touchmove",R,{passive:!1}),document.addEventListener("mouseup",B),document.addEventListener("touchend",B)}function P(e){e.preventDefault();const t=e.target.closest(".tetris-piece");if(!t||t.classList.contains("unplaceable"))return;const n=JSON.parse(t.dataset.shape),o=t.getBoundingClientRect(),c=e.clientX||e.touches[0].clientX,r=e.clientY||e.touches[0].clientY,s=o.width/2,a=o.height/2,i=o.width/n[0].length,[f,d]=ne(n,s,a,i);l=document.createElement("div"),l.className="dragged-piece",l.style.position="fixed",l.style.pointerEvents="none",l.style.zIndex="1000",l.style.opacity="0.8";const m=document.querySelector(".grid-cell").offsetWidth;l.style.width=`${n[0].length*m}px`,l.style.height=`${n.length*m}px`;const u=document.createElement("div");u.style.display="grid",u.style.width="100%",u.style.height="100%",u.style.gridTemplateColumns=`repeat(${n[0].length}, 1fr)`,u.style.gridTemplateRows=`repeat(${n.length}, 1fr)`;const g=t.dataset.color;l.dataset.color=g,console.log("b",g),n.forEach((p,E)=>{p.forEach((T,oe)=>{const y=document.createElement("div");y.style.backgroundImage=T?'url("./bubble.png")':"transparent",y.style.backgroundSize="cover",console.log("a",g);const N=S(g);y.style.filter=`hue-rotate(${N}deg)`,u.appendChild(y)})}),l.appendChild(u),document.body.appendChild(l),O(c,r),l.dataset.shape=JSON.stringify(n),l.dataset.activeRow=f,l.dataset.activeCol=d,l.dataset.originalId=t.id,l.dataset.color=g,t.classList.add("dragging")}function R(e){if(e.preventDefault(),l){const t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY;b=t,w=n,document.querySelector(".grid-cell").offsetWidth,parseInt(l.dataset.activeRow||0),parseInt(l.dataset.activeCol||0),O(t,n),G(t,n)}}function B(e){if(e.preventDefault(),!l)return;const t=e.clientX||b,n=e.clientY||w,o=document.querySelector(".grid-cell").offsetWidth,c=l.dataset.originalId,r=JSON.parse(l.dataset.shape);b=0,w=0;const s=5,i=document.getElementById("game-grid-container").getBoundingClientRect();if(t<i.left||t>i.right||n<i.top||n>i.bottom){M(c),k(),v();return}const f=l.offsetWidth,d=l.offsetHeight,m=Math.floor((t-i.left-5-f/2)/o),g=Math.floor((n-i.top-5-d/2)/o)*s+m;if(x(r,g,s)){const p=l.dataset.color;F(r,g,s,p),J(document.getElementById(c))}else M(c);k(),v()}function O(e,t,n,o,c){if(l){const r=l.offsetWidth,s=l.offsetHeight,a=r/2,i=s/2;l.style.left=`${e-a}px`,l.style.top=`${t-i}px`}}function G(e,t){if(!l)return;const n=JSON.parse(l.dataset.shape),o=5,r=document.getElementById("game-grid-container").getBoundingClientRect(),s=(r.width-10)/o,a=l.offsetWidth,i=l.offsetHeight,f=Math.floor((e-r.left-5-a/2)/s),d=Math.floor((t-r.top-5-i/2)/s),m=d*o+f;if(v(),x(n,m,o)){for(let u=0;u<n.length;u++)for(let g=0;g<n[u].length;g++)if(n[u][g]){const p=(d+u)*o+(f+g),E=document.querySelector(`.grid-cell[data-index="${p}"]`);E&&E.classList.add("preview")}}}function v(){document.querySelectorAll(".grid-cell.preview").forEach(e=>{e.classList.remove("preview")})}function x(e,t,n){const o=Math.floor(t/n),c=t%n;for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length;s++)if(e[r][s]){const a=o+r,i=c+s;if(a>=n||i>=n||a<0||i<0)return!1;const f=a*n+i,d=document.querySelector(`.grid-cell[data-index="${f}"]`);if(!d||d.style.backgroundImage!=="")return!1}return!0}function F(e,t,n,o){const c=Math.floor(t/n),r=t%n;for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(e[s][a]){const i=(c+s)*n+(r+a),f=document.querySelector(`.grid-cell[data-index="${i}"]`);if(f){f.style.backgroundImage='url("./bubble.png")',f.style.backgroundSize="cover";const d=S(o);f.style.filter=`hue-rotate(${d}deg)`}}K(n),h()}function K(e){let t=[],n=[];for(let o=0;o<e;o++)U(o,e)&&t.push(o),j(o,e)&&n.push(o);t.forEach(o=>z(o,e)),n.forEach(o=>Z(o,e)),Q(t.length,n.length),h()}function U(e,t){for(let n=0;n<t;n++){const o=e*t+n;if(document.querySelector(`.grid-cell[data-index="${o}"]`).style.backgroundImage==="")return!1}return!0}function j(e,t){for(let n=0;n<t;n++){const o=n*t+e;if(document.querySelector(`.grid-cell[data-index="${o}"]`).style.backgroundImage==="")return!1}return!0}function z(e,t){for(let n=0;n<t;n++){const o=e*t+n,c=document.querySelector(`.grid-cell[data-index="${o}"]`);c.style.backgroundImage="",c.style.filter=""}}function Z(e,t){for(let n=0;n<t;n++){const o=n*t+e,c=document.querySelector(`.grid-cell[data-index="${o}"]`);c.style.backgroundImage="",c.style.filter=""}}function Q(e,t){let n=0;e>0&&t>0?n=10:n=e+t,C+=n;const o=document.getElementById("score");o?o.textContent=`Score: ${C}`:console.error("Score element not found")}function V(){document.querySelectorAll(".grid-cell").forEach(c=>{c.style.backgroundImage="",c.style.filter="",c.classList.remove("preview")}),C=0;const t=document.getElementById("score");t&&(t.textContent="Score: 0");const n=document.getElementById("tetris-bank");n.innerHTML="",I(),l&&(l.remove(),l=null),document.querySelectorAll(".tetris-piece").forEach(c=>{c.style.opacity="1"}),document.draggedPiece&&(document.draggedPiece=null),I(),h()}function _(){A(),I(),W();const e=document.createElement("div");e.id="score",e.textContent="Score: 0",document.getElementById("app").insertBefore(e,document.getElementById("game-container")),document.getElementById("reset-button").addEventListener("click",n=>{n.preventDefault(),V(),n.dataTransfer&&(n.dataTransfer.dropEffect="none",n.dataTransfer.effectAllowed="none")})}function ee(e){k(),v()}function k(){l&&(l.remove(),l=null),document.querySelectorAll(".tetris-piece").forEach(t=>{t.classList.remove("dragging")})}function te(e){for(let n=0;n<5;n++)for(let o=0;o<5;o++){const c=n*5+o;if(x(e,c,5))return!0}return!1}function h(){document.querySelectorAll(".tetris-piece").forEach(t=>{const n=JSON.parse(t.dataset.shape),o=te(n);t.classList.toggle("unplaceable",!o),t.draggable=o})}function M(e){const t=document.getElementById(e);t&&t.classList.remove("dragging")}function ne(e,t,n,o){const c=Math.floor(n/o),r=Math.floor(t/o);if(e[c]&&e[c][r])return[c,r];const s=e.length,a=e[0].length;let i=1/0,f=[0,0];for(let d=0;d<s;d++)for(let m=0;m<a;m++)if(e[d][m]){const u=Math.sqrt(Math.pow(d-c,2)+Math.pow(m-r,2));u<i&&(i=u,f=[d,m])}return f}document.addEventListener("DOMContentLoaded",_);
