(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();const a=8,U=3,F=10,H=1,R="./bubble.png",N=100;function K(e){return e.length,e[0].map((t,r)=>e.map(o=>o[r]).reverse())}function L(e){const n=W(e),t=Z(n.r,n.g,n.b);return Math.round(t[0]*360)}function W(e){e=e.replace(/^#/,"");const n=parseInt(e,16),t=n>>16&255,r=n>>8&255,o=n&255;return{r:t,g:r,b:o}}function Z(e,n,t){e/=255,n/=255,t/=255;const r=Math.max(e,n,t),o=Math.min(e,n,t);let c,l,s=(r+o)/2;if(r===o)c=l=0;else{const i=r-o;switch(l=s>.5?i/(2-r-o):i/(r+o),r){case e:c=(n-t)/i+(n<t?6:0);break;case n:c=(t-e)/i+2;break;case t:c=(e-n)/i+4;break}c/=6}return[c,l,s]}function j(e,n,t,r){const o=Math.floor(t/r),c=Math.floor(n/r);if(e[o]&&e[o][c])return[o,c];const l=e.length,s=e[0].length;let i=1/0,f=[0,0];for(let u=0;u<l;u++)for(let g=0;g<s;g++)if(e[u][g]){const h=Math.sqrt(Math.pow(u-o,2)+Math.pow(g-c,2));h<i&&(i=h,f=[u,g])}return f}function O(e){return document.querySelector(`.grid-cell[data-index="${e}"]`)}function V(e,n,t){const r=O(e);if(r)if(r.style.backgroundImage=`url("${n}")`,r.style.backgroundSize="cover",t){const o=L(t);r.style.filter=`hue-rotate(${o}deg)`}else r.style.filter=""}function A(e,n,t,r,o){const c=t.width/a,l=Math.floor((e-t.left)/c)-o,s=Math.floor((n-t.top)/c)-r,i=s*a+l;return{targetCol:l,targetRow:s,targetIndex:i}}let S=0;function z(e,n){let t=0;e>0&&n>0?t=F:t=(e+n)*H,S+=t,D()}function D(){const e=document.getElementById("score");e?e.textContent=`Score: ${S}`:console.error("Score element not found")}function Q(){S=0,D()}function I(e,n){const t=Math.floor(n/a),r=n%a;for(let o=0;o<e.length;o++)for(let c=0;c<e[o].length;c++)if(e[o][c]){const l=t+o,s=r+c;if(l>=a||s>=a||l<0||s<0)return!1;const i=l*a+s,f=O(i);if(!f||f.style.backgroundImage!=="")return!1}return!0}function B(e,n,t){const r=Math.floor(n/a),o=n%a;for(let c=0;c<e.length;c++)for(let l=0;l<e[c].length;l++)if(e[c][l]){const s=(r+c)*a+(o+l);V(s,R,t)}ee()}function ee(){let e=[],n=[];for(let t=0;t<a;t++)te(t,a)&&e.push(t),ne(t,a)&&n.push(t);e.forEach(t=>oe(t,a)),n.forEach(t=>ce(t,a)),z(e.length,n.length)}function te(e,n){for(let t=0;t<n;t++){const r=e*n+t;if(document.querySelector(`.grid-cell[data-index="${r}"]`).style.backgroundImage==="")return!1}return!0}function ne(e,n){for(let t=0;t<n;t++){const r=t*n+e;if(document.querySelector(`.grid-cell[data-index="${r}"]`).style.backgroundImage==="")return!1}return!0}function oe(e,n){for(let t=0;t<n;t++){const r=e*n+t,o=document.querySelector(`.grid-cell[data-index="${r}"]`);o.style.backgroundImage="",o.style.filter=""}}function ce(e,n){for(let t=0;t<n;t++){const r=t*n+e,o=document.querySelector(`.grid-cell[data-index="${r}"]`);o.style.backgroundImage="",o.style.filter=""}}function re(){document.querySelectorAll(".grid-cell").forEach(n=>{n.style.backgroundImage="",n.style.filter="",n.classList.remove("preview")}),Q(),J(),y()}function le(e){e.preventDefault(),re(),e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.dataTransfer.effectAllowed="none")}let d=null,b=0,P=0;function se(){document.removeEventListener("mousedown",v),document.removeEventListener("touchstart",v),document.removeEventListener("mousemove",E),document.removeEventListener("touchmove",E),document.removeEventListener("mouseup",w),document.removeEventListener("touchend",w),document.addEventListener("mousedown",v),document.addEventListener("touchstart",v),document.addEventListener("mousemove",E),document.addEventListener("touchmove",E),document.addEventListener("mouseup",w),document.addEventListener("touchend",w)}function v(e){const n=e.target.closest(".tetris-piece");if(!n||n.classList.contains("unplaceable"))return;e.preventDefault();const t=JSON.parse(n.dataset.shape),r=n.getBoundingClientRect();let o=e.clientX||e.touches[0].clientX,c=e.clientY||e.touches[0].clientY;c-=N;const l=r.width/2,s=r.height/2,i=r.width/t[0].length,[f,u]=j(t,l,s,i);d=ae(t,n.dataset.color,f,u,n.id),document.body.appendChild(d),G(o,c,f,u,i)}function E(e){if(!d)return;e.preventDefault();let n=e.clientX||e.touches[0].clientX,t=e.clientY||e.touches[0].clientY;t-=N,b=n,P=t;const r=document.querySelector(".grid-cell").offsetWidth,o=parseInt(d.dataset.activeRow||0),c=parseInt(d.dataset.activeCol||0);G(n,t,o,c,r),de(n,t)}function w(e){if(!d||e.target.nodeName==="BUTTON")return;e.preventDefault();let n=b||e.clientX||e.changedTouches[0].clientX,t=P||e.clientY||e.changedTouches[0].clientY;const o=document.getElementById("game-grid-container").getBoundingClientRect(),c=d.dataset.originalId,l=JSON.parse(d.dataset.shape),s=parseInt(d.dataset.activeRow),i=parseInt(d.dataset.activeCol);if(b=null,P=null,n<o.left||n>o.right||t<o.top||t>o.bottom){T(c),M(),C();return}const{targetIndex:f}=A(n,t,o,s,i);if(I(l,f)){const u=d.dataset.color;B(l,f,u),$(document.getElementById(c)),y()}else{const u=q(l,Math.floor(f/a),f%a);if(u){const{row:g,col:h}=u,m=g*a+h,p=d.dataset.color;B(l,m,p),$(document.getElementById(c)),y()}else T(c)}M(),C()}function ae(e,n,t,r,o){const c=document.createElement("div");c.className="dragged-piece",c.style.position="fixed",c.style.pointerEvents="none",c.style.zIndex="1000",c.style.opacity="0.8";const l=document.querySelector(".grid-cell").offsetWidth;c.style.width=`${e[0].length*l}px`,c.style.height=`${e.length*l}px`;const s=ie(e,n);return c.appendChild(s),c.dataset.shape=JSON.stringify(e),c.dataset.activeRow=t,c.dataset.activeCol=r,c.dataset.originalId=o,c.dataset.color=n,c}function ie(e,n){const t=document.createElement("div");return t.style.display="grid",t.style.width="100%",t.style.height="100%",t.style.gridTemplateColumns=`repeat(${e[0].length}, 1fr)`,t.style.gridTemplateRows=`repeat(${e.length}, 1fr)`,e.forEach(r=>{r.forEach(o=>{const c=document.createElement("div");c.style.backgroundImage=o?`url("${R}")`:"none",c.style.backgroundSize="cover";const l=L(n);c.style.filter=`hue-rotate(${l}deg)`,t.appendChild(c)})}),t}function G(e,n,t,r,o){if(d){const c=JSON.parse(d.dataset.shape);c[0].length*o,c.length*o;const l=(r+.5)*o,s=(t+.5)*o;d.style.left=`${e-l}px`,d.style.top=`${n-s}px`}}function de(e,n){if(!d)return;const t=JSON.parse(d.dataset.shape),o=document.getElementById("game-grid-container").getBoundingClientRect();if(e<o.left||e>o.right||n<o.top||n>o.bottom){C();return}const c=parseInt(d.dataset.activeRow),l=parseInt(d.dataset.activeCol),{targetCol:s,targetRow:i,targetIndex:f}=A(e,n,o,c,l);if(C(),I(t,f)){for(let u=0;u<t.length;u++)for(let g=0;g<t[u].length;g++)if(t[u][g]){const h=(i+u)*a+(s+g),m=document.querySelector(`.grid-cell[data-index="${h}"]`);m&&m.classList.add("preview")}}else{const u=q(t,i,s);if(u){const{row:g,col:h}=u;for(let m=0;m<t.length;m++)for(let p=0;p<t[m].length;p++)if(t[m][p]){const Y=(g+m)*a+(h+p),x=document.querySelector(`.grid-cell[data-index="${Y}"]`);x&&x.classList.add("preview")}}}}function q(e,n,t){const r=Math.max(a-e.length,a-e[0].length);for(let o=1;o<=r;o++)for(let c=-o;c<=o;c++)for(let l=-o;l<=o;l++)if(Math.abs(c)===o||Math.abs(l)===o){const s=n+c,i=t+l,f=s*a+i;if(I(e,f))return{row:s,col:i}}return null}function C(){document.querySelectorAll(".grid-cell.preview").forEach(e=>{e.classList.remove("preview")})}function M(){d&&(d.remove(),d=null)}function T(e){const n=document.getElementById(e);n&&n.classList.remove("dragging")}const k={I:{shape:[[1,1,1,1]],color:"#00f0f0"},L:{shape:[[1,0],[1,0],[1,1]],color:"#c54155"},J:{shape:[[0,1],[0,1],[1,1]],color:"#c54155"},T:{shape:[[1,1,1],[0,1,0]],color:"#a000f0"},O:{shape:[[1,1],[1,1]],color:"#ae59b3"},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000"},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000"},Single:{shape:[[1]],color:"#f0a0f0"},Plus:{shape:[[0,1,0],[1,1,1],[0,1,0]],color:"#a0a0a0"},U:{shape:[[1,0,1],[1,1,1]],color:"#7bac3c"},BigSquare:{shape:[[1,1,1],[1,1,1],[1,1,1]],color:"#9e4b1e"},Two:{shape:[[1,1]],color:"#3c77b9"}};function _(){const e=Object.keys(k),n=e[Math.floor(Math.random()*e.length)];return{key:n,piece:k[n]}}function $(e){const n=document.getElementById("tetris-bank"),t=_();return e.remove(),X(t.key,t.piece,n),y(),t}function ue(){const e=document.getElementById("game-grid");for(let n=0;n<a*a;n++){const t=document.createElement("div");t.className="grid-cell",t.dataset.index=n,e.appendChild(t)}}function J(){const e=document.getElementById("tetris-bank");e.innerHTML="";for(let n=0;n<U;n++){const t=_();X(t.key,t.piece,e)}y()}function X(e,n,t){const r=document.createElement("div");r.className="tetris-piece",r.id=`piece-${e}-${Date.now()}`;const o=document.createElement("div");o.className="piece-grid";let c=JSON.parse(JSON.stringify(n.shape));const l=Math.floor(Math.random()*4);for(let s=0;s<l;s++)c=K(c);r.dataset.shape=JSON.stringify(c),r.dataset.color=n.color,ge(o,c,n.color),r.appendChild(o),t.appendChild(r),r.setAttribute("draggable",!0)}function y(){document.querySelectorAll(".tetris-piece").forEach(n=>{const t=JSON.parse(n.dataset.shape),r=fe(t);n.classList.toggle("unplaceable",!r),n.draggable=r})}function fe(e){for(let n=0;n<a;n++)for(let t=0;t<a;t++){const r=n*a+t;if(I(e,r))return!0}return!1}function ge(e,n,t){e.innerHTML="",e.style.display="grid",e.style.gridTemplateRows=`repeat(${n.length}, 10px)`,e.style.gridTemplateColumns=`repeat(${n[0].length}, 10px)`,n.forEach(r=>{r.forEach(o=>{const c=document.createElement("div");if(c.className="piece-cell",o){c.style.backgroundImage=`url("${R}")`,c.style.backgroundSize="cover";const l=L(t);c.style.filter=`hue-rotate(${l}deg)`}e.appendChild(c)})})}function me(){console.log("go"),ue(),J();const e=document.createElement("div");e.id="score",e.textContent="Score: 0",document.getElementById("app").insertBefore(e,document.getElementById("game-container"))}function he(){me(),se(),document.getElementById("reset-button").addEventListener("click",le)}document.addEventListener("DOMContentLoaded",he);
