(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=t(c);fetch(c.href,r)}})();let b=0,w=0;const x={I:{shape:[[1,1,1,1]],color:"#00f0f0"},L:{shape:[[1,0],[1,0],[1,1]],color:"#c54155"},J:{shape:[[0,1],[0,1],[1,1]],color:"#c54155"},T:{shape:[[1,1,1],[0,1,0]],color:"#a000f0"},O:{shape:[[1,1],[1,1]],color:"#ae59b3"},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000"},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000"},Single:{shape:[[1]],color:"#f0a0f0"},Plus:{shape:[[0,1,0],[1,1,1],[0,1,0]],color:"#a0a0a0"},U:{shape:[[1,0,1],[1,1,1]],color:"#7bac3c"},BigSquare:{shape:[[1,1,1],[1,1,1],[1,1,1]],color:"#9e4b1e"},Two:{shape:[[1,1]],color:"#3c77b9"}};let C=0,l=null;const m=8;function A(){const n=document.getElementById("game-grid");for(let e=0;e<m*m;e++){const t=document.createElement("div");t.className="grid-cell",t.dataset.index=e,n.appendChild(t)}}function T(n,e,t){const o=document.createElement("div");o.className="tetris-piece",o.id=`piece-${n}-${Date.now()}`;const c=document.createElement("div");c.className="piece-grid";let r=JSON.parse(JSON.stringify(e.shape));const s=Math.floor(Math.random()*4);for(let a=0;a<s;a++)r=Y(r);o.dataset.shape=JSON.stringify(r),o.dataset.color=e.color,D(c,r,e.color),o.appendChild(c),t.appendChild(o),o.setAttribute("draggable",!0),o.addEventListener("mousedown",E),o.addEventListener("touchstart",E)}function D(n,e,t){n.innerHTML="",n.style.display="grid",n.style.gridTemplateRows=`repeat(${e.length}, 10px)`,n.style.gridTemplateColumns=`repeat(${e[0].length}, 10px)`,e.forEach(o=>{o.forEach(c=>{const r=document.createElement("div");if(r.className="piece-cell",c){r.style.backgroundImage='url("./bubble.png")',r.style.backgroundSize="cover";const s=k(t);r.style.filter=`hue-rotate(${s}deg)`}n.appendChild(r)})})}function k(n){const e=H(n),t=X(e.r,e.g,e.b);return Math.round(t[0]*360)}function H(n){n=n.replace(/^#/,"");const e=parseInt(n,16),t=e>>16&255,o=e>>8&255,c=e&255;return{r:t,g:o,b:c}}function X(n,e,t){n/=255,e/=255,t/=255;const o=Math.max(n,e,t),c=Math.min(n,e,t);let r,s,a=(o+c)/2;if(o===c)r=s=0;else{const i=o-c;switch(s=a>.5?i/(2-o-c):i/(o+c),o){case n:r=(e-t)/i+(e<t?6:0);break;case e:r=(t-n)/i+2;break;case t:r=(n-e)/i+4;break}r/=6}return[r,s,a]}function Y(n){return n.length,n[0].map((t,o)=>n.map(c=>c[o]).reverse())}function I(){const n=document.getElementById("tetris-bank");n.innerHTML="";const e=3;for(let t=0;t<e;t++){const o=$();T(o.key,o.piece,n)}p()}function $(){const n=Object.keys(x),e=n[Math.floor(Math.random()*n.length)];return{key:e,piece:x[e]}}function J(n){const e=document.getElementById("tetris-bank"),t=$();n.remove(),T(t.key,t.piece,e),p()}function W(){document.querySelectorAll(".tetris-piece").forEach(e=>{e.addEventListener("mousedown",E),e.addEventListener("touchstart",E)}),document.addEventListener("mousemove",B),document.addEventListener("touchmove",B),document.addEventListener("mouseup",R),document.addEventListener("touchend",R)}function E(n){n.preventDefault();const e=n.target.closest(".tetris-piece");if(!e||e.classList.contains("unplaceable"))return;const t=JSON.parse(e.dataset.shape),o=e.getBoundingClientRect();let c=n.clientX||n.touches[0].clientX,r=n.clientY||n.touches[0].clientY;r-=100;const s=o.width/2,a=o.height/2,i=o.width/t[0].length,[u,f]=te(t,s,a,i);l=document.createElement("div"),l.className="dragged-piece",l.style.position="fixed",l.style.pointerEvents="none",l.style.zIndex="1000",l.style.opacity="0.8";const g=document.querySelector(".grid-cell").offsetWidth;l.style.width=`${t[0].length*g}px`,l.style.height=`${t.length*g}px`;const d=document.createElement("div");d.style.display="grid",d.style.width="100%",d.style.height="100%",d.style.gridTemplateColumns=`repeat(${t[0].length}, 1fr)`,d.style.gridTemplateRows=`repeat(${t.length}, 1fr)`;const h=e.dataset.color;l.dataset.color=h,t.forEach((y,ne)=>{y.forEach((q,oe)=>{const v=document.createElement("div");v.style.backgroundImage=q?'url("./bubble.png")':"transparent",v.style.backgroundSize="cover";const N=k(h);v.style.filter=`hue-rotate(${N}deg)`,d.appendChild(v)})}),l.appendChild(d),document.body.appendChild(l),O(c,r),l.dataset.shape=JSON.stringify(t),l.dataset.activeRow=u,l.dataset.activeCol=f,l.dataset.originalId=e.id,l.dataset.color=h,e.classList.add("dragging")}function B(n){if(n.preventDefault(),l){let e=n.clientX||n.touches[0].clientX,t=n.clientY||n.touches[0].clientY;t-=100,b=e,w=t,document.querySelector(".grid-cell").offsetWidth,parseInt(l.dataset.activeRow||0),parseInt(l.dataset.activeCol||0),O(e,t),G(e,t)}}function R(n){if(n.target.nodeName==="BUTTON"||(n.preventDefault(),!l))return;let e=b,t=w;const c=document.getElementById("game-grid-container").getBoundingClientRect(),r=c.width/m,s=l.dataset.originalId,a=JSON.parse(l.dataset.shape);if(b=null,w=null,e<c.left||e>c.right||t<c.top||t>c.bottom){S(s),M(),P();return}const i=l.offsetWidth,u=l.offsetHeight,f=Math.floor((e-c.left-i/2)/r),d=Math.floor((t-c.top-u/2)/r)*m+f;if(L(a,d,m)){const h=l.dataset.color;U(a,d,m,h),J(document.getElementById(s))}else S(s);M(),P()}function O(n,e,t,o,c){if(l){const r=l.offsetWidth,s=l.offsetHeight,a=r/2,i=s/2;l.style.left=`${n-a}px`,l.style.top=`${e-i}px`}}function G(n,e){if(!l)return;const t=JSON.parse(l.dataset.shape),c=document.getElementById("game-grid-container").getBoundingClientRect(),r=c.width/m,s=l.offsetWidth,a=l.offsetHeight,i=Math.floor((n-c.left-s/2)/r),u=Math.floor((e-c.top-a/2)/r),f=u*m+i;if(P(),L(t,f,m)){for(let g=0;g<t.length;g++)for(let d=0;d<t[g].length;d++)if(t[g][d]){const h=(u+g)*m+(i+d),y=document.querySelector(`.grid-cell[data-index="${h}"]`);y&&y.classList.add("preview")}}}function P(){document.querySelectorAll(".grid-cell.preview").forEach(n=>{n.classList.remove("preview")})}function L(n,e,t){const o=Math.floor(e/t),c=e%t;console.log("can place piece",n,e,t,o,c);for(let r=0;r<n.length;r++)for(let s=0;s<n[r].length;s++)if(n[r][s]){const a=o+r,i=c+s;if(a>=t||i>=t||a<0||i<0)return!1;const u=a*t+i,f=document.querySelector(`.grid-cell[data-index="${u}"]`);if(!f||f.style.backgroundImage!=="")return!1}return!0}function U(n,e,t,o){const c=Math.floor(e/t),r=e%t;for(let s=0;s<n.length;s++)for(let a=0;a<n[s].length;a++)if(n[s][a]){const i=(c+s)*t+(r+a),u=document.querySelector(`.grid-cell[data-index="${i}"]`);if(u){u.style.backgroundImage='url("./bubble.png")',u.style.backgroundSize="cover";const f=k(o);u.style.filter=`hue-rotate(${f}deg)`}}F(t),p()}function F(n){let e=[],t=[];for(let o=0;o<n;o++)K(o,n)&&e.push(o),j(o,n)&&t.push(o);e.forEach(o=>Z(o,n)),t.forEach(o=>Q(o,n)),V(e.length,t.length),p()}function K(n,e){for(let t=0;t<e;t++){const o=n*e+t;if(document.querySelector(`.grid-cell[data-index="${o}"]`).style.backgroundImage==="")return!1}return!0}function j(n,e){for(let t=0;t<e;t++){const o=t*e+n;if(document.querySelector(`.grid-cell[data-index="${o}"]`).style.backgroundImage==="")return!1}return!0}function Z(n,e){for(let t=0;t<e;t++){const o=n*e+t,c=document.querySelector(`.grid-cell[data-index="${o}"]`);c.style.backgroundImage="",c.style.filter=""}}function Q(n,e){for(let t=0;t<e;t++){const o=t*e+n,c=document.querySelector(`.grid-cell[data-index="${o}"]`);c.style.backgroundImage="",c.style.filter=""}}function V(n,e){let t=0;n>0&&e>0?t=10:t=n+e,C+=t;const o=document.getElementById("score");o?o.textContent=`Score: ${C}`:console.error("Score element not found")}function _(){document.querySelectorAll(".grid-cell").forEach(c=>{c.style.backgroundImage="",c.style.filter="",c.classList.remove("preview")}),C=0;const e=document.getElementById("score");e&&(e.textContent="Score: 0");const t=document.getElementById("tetris-bank");t.innerHTML="",I(),l&&(l.remove(),l=null),document.querySelectorAll(".tetris-piece").forEach(c=>{c.style.opacity="1"}),document.draggedPiece&&(document.draggedPiece=null),I(),p()}function z(){A(),I(),W();const n=document.createElement("div");n.id="score",n.textContent="Score: 0",document.getElementById("app").insertBefore(n,document.getElementById("game-container")),document.getElementById("reset-button").addEventListener("click",t=>{t.preventDefault(),_(),t.dataTransfer&&(t.dataTransfer.dropEffect="none",t.dataTransfer.effectAllowed="none")})}function M(){l&&(l.remove(),l=null),document.querySelectorAll(".tetris-piece").forEach(e=>{e.classList.remove("dragging")})}function ee(n){for(let e=0;e<m;e++)for(let t=0;t<m;t++){const o=e*m+t;if(L(n,o,m))return!0}return!1}function p(){document.querySelectorAll(".tetris-piece").forEach(e=>{const t=JSON.parse(e.dataset.shape),o=ee(t);e.classList.toggle("unplaceable",!o),e.draggable=o})}function S(n){const e=document.getElementById(n);e&&e.classList.remove("dragging")}function te(n,e,t,o){const c=Math.floor(t/o),r=Math.floor(e/o);if(n[c]&&n[c][r])return[c,r];const s=n.length,a=n[0].length;let i=1/0,u=[0,0];for(let f=0;f<s;f++)for(let g=0;g<a;g++)if(n[f][g]){const d=Math.sqrt(Math.pow(f-c,2)+Math.pow(g-r,2));d<i&&(i=d,u=[f,g])}return u}document.addEventListener("DOMContentLoaded",z);
