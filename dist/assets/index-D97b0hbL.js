(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();let b=0,w=0;const x={I:{shape:[[1,1,1,1]],color:"#00f0f0"},L:{shape:[[1,0],[1,0],[1,1]],color:"#f0a000"},J:{shape:[[0,1],[0,1],[1,1]],color:"#0000f0"},T:{shape:[[1,1,1],[0,1,0]],color:"#a000f0"},O:{shape:[[1,1],[1,1]],color:"#f0f000"},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000"},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000"},Single:{shape:[[1]],color:"#f0a0f0"},Plus:{shape:[[0,1,0],[1,1,1],[0,1,0]],color:"#a0a0a0"},U:{shape:[[1,0,1],[1,1,1]],color:"#f0f0a0"}};let C=0,l=null;function A(){const e=document.getElementById("game-grid"),t=5;for(let o=0;o<t*t;o++){const n=document.createElement("div");n.className="grid-cell",n.dataset.index=o,e.appendChild(n)}}function $(e,t,o){const n=document.createElement("div");n.className="tetris-piece",n.id=`piece-${e}-${Date.now()}`;const c=document.createElement("div");c.className="piece-grid";let r=JSON.parse(JSON.stringify(t.shape));const s=Math.floor(Math.random()*4);for(let a=0;a<s;a++)r=Y(r);n.dataset.shape=JSON.stringify(r),n.dataset.color=t.color,D(c,r,t.color),n.appendChild(c),o.appendChild(n),n.setAttribute("draggable",!0),n.addEventListener("mousedown",v),n.addEventListener("touchstart",v)}function D(e,t,o){e.innerHTML="",e.style.display="grid",e.style.gridTemplateRows=`repeat(${t.length}, 10px)`,e.style.gridTemplateColumns=`repeat(${t[0].length}, 10px)`,t.forEach(n=>{n.forEach(c=>{const r=document.createElement("div");if(r.className="piece-cell",c){r.style.backgroundImage='url("./bubble.png")',r.style.backgroundSize="cover";const s=k(o);r.style.filter=`hue-rotate(${s}deg)`}e.appendChild(r)})})}function k(e){const t=H(e),o=X(t.r,t.g,t.b);return Math.round(o[0]*360)}function H(e){e=e.replace(/^#/,"");const t=parseInt(e,16),o=t>>16&255,n=t>>8&255,c=t&255;return{r:o,g:n,b:c}}function X(e,t,o){e/=255,t/=255,o/=255;const n=Math.max(e,t,o),c=Math.min(e,t,o);let r,s,a=(n+c)/2;if(n===c)r=s=0;else{const i=n-c;switch(s=a>.5?i/(2-n-c):i/(n+c),n){case e:r=(t-o)/i+(t<o?6:0);break;case t:r=(o-e)/i+2;break;case o:r=(e-t)/i+4;break}r/=6}return[r,s,a]}function Y(e){return e.length,e[0].map((o,n)=>e.map(c=>c[n]).reverse())}function I(){const e=document.getElementById("tetris-bank");e.innerHTML="";const t=5;for(let o=0;o<t;o++){const n=T();$(n.key,n.piece,e)}h()}function T(){const e=Object.keys(x),t=e[Math.floor(Math.random()*e.length)];return{key:t,piece:x[t]}}function J(e){const t=document.getElementById("tetris-bank"),o=T();e.remove(),$(o.key,o.piece,t),h()}function W(){document.querySelectorAll(".tetris-piece").forEach(t=>{t.addEventListener("mousedown",v),t.addEventListener("touchstart",v)}),document.addEventListener("mousemove",L),document.addEventListener("touchmove",L),document.addEventListener("mouseup",R),document.addEventListener("touchend",R)}function v(e){console.log("dragStart",e),e.preventDefault();const t=e.target.closest(".tetris-piece");if(!t||t.classList.contains("unplaceable"))return;console.log("pieceElement",t);const o=JSON.parse(t.dataset.shape),n=t.getBoundingClientRect(),c=e.clientX||e.touches[0].clientX,r=e.clientY||e.touches[0].clientY,s=n.width/2,a=n.height/2,i=n.width/o[0].length,[f,d]=te(o,s,a,i);l=document.createElement("div"),l.className="dragged-piece",l.style.position="fixed",l.style.pointerEvents="none",l.style.zIndex="1000",l.style.opacity="0.8";const m=document.querySelector(".grid-cell").offsetWidth;l.style.width=`${o[0].length*m}px`,l.style.height=`${o.length*m}px`;const u=document.createElement("div");u.style.display="grid",u.style.width="100%",u.style.height="100%",u.style.gridTemplateColumns=`repeat(${o[0].length}, 1fr)`,u.style.gridTemplateRows=`repeat(${o.length}, 1fr)`;const g=t.dataset.color;l.dataset.color=g,console.log("b",g),o.forEach((p,E)=>{p.forEach((q,oe)=>{const y=document.createElement("div");y.style.backgroundImage=q?'url("./bubble.png")':"transparent",y.style.backgroundSize="cover",console.log("a",g);const N=k(g);y.style.filter=`hue-rotate(${N}deg)`,u.appendChild(y)})}),l.appendChild(u),document.body.appendChild(l),O(c,r),l.dataset.shape=JSON.stringify(o),l.dataset.activeRow=f,l.dataset.activeCol=d,l.dataset.originalId=t.id,l.dataset.color=g,t.classList.add("dragging")}function L(e){if(console.log("drag",e),e.preventDefault(),l){const t=e.clientX||e.touches[0].clientX,o=e.clientY||e.touches[0].clientY;b=t,w=o,document.querySelector(".grid-cell").offsetWidth,parseInt(l.dataset.activeRow||0),parseInt(l.dataset.activeCol||0),O(t,o),G(t,o)}}function R(e){if(console.log("drop",e.target),e.target.nodeName==="BUTTON"||(e.preventDefault(),!l))return;const t=e.clientX||b,o=e.clientY||w,n=document.querySelector(".grid-cell").offsetWidth,c=l.dataset.originalId,r=JSON.parse(l.dataset.shape);b=null,w=null;const s=5,i=document.getElementById("game-grid-container").getBoundingClientRect();if(t<i.left||t>i.right||o<i.top||o>i.bottom){M(c),B(),P();return}const f=l.offsetWidth,d=l.offsetHeight,m=Math.floor((t-i.left-5-f/2)/n),g=Math.floor((o-i.top-5-d/2)/n)*s+m;if(S(r,g,s)){const p=l.dataset.color;U(r,g,s,p),J(document.getElementById(c))}else M(c);B(),P()}function O(e,t,o,n,c){if(l){const r=l.offsetWidth,s=l.offsetHeight,a=r/2,i=s/2;l.style.left=`${e-a}px`,l.style.top=`${t-i}px`}}function G(e,t){if(!l)return;const o=JSON.parse(l.dataset.shape),n=5,r=document.getElementById("game-grid-container").getBoundingClientRect(),s=(r.width-10)/n,a=l.offsetWidth,i=l.offsetHeight,f=Math.floor((e-r.left-5-a/2)/s),d=Math.floor((t-r.top-5-i/2)/s),m=d*n+f;if(P(),S(o,m,n)){for(let u=0;u<o.length;u++)for(let g=0;g<o[u].length;g++)if(o[u][g]){const p=(d+u)*n+(f+g),E=document.querySelector(`.grid-cell[data-index="${p}"]`);E&&E.classList.add("preview")}}}function P(){document.querySelectorAll(".grid-cell.preview").forEach(e=>{e.classList.remove("preview")})}function S(e,t,o){const n=Math.floor(t/o),c=t%o;for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length;s++)if(e[r][s]){const a=n+r,i=c+s;if(a>=o||i>=o||a<0||i<0)return!1;const f=a*o+i,d=document.querySelector(`.grid-cell[data-index="${f}"]`);if(!d||d.style.backgroundImage!=="")return!1}return!0}function U(e,t,o,n){const c=Math.floor(t/o),r=t%o;for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(e[s][a]){const i=(c+s)*o+(r+a),f=document.querySelector(`.grid-cell[data-index="${i}"]`);if(f){f.style.backgroundImage='url("./bubble.png")',f.style.backgroundSize="cover";const d=k(n);f.style.filter=`hue-rotate(${d}deg)`}}F(o),h()}function F(e){let t=[],o=[];for(let n=0;n<e;n++)K(n,e)&&t.push(n),j(n,e)&&o.push(n);t.forEach(n=>z(n,e)),o.forEach(n=>Z(n,e)),Q(t.length,o.length),h()}function K(e,t){for(let o=0;o<t;o++){const n=e*t+o;if(document.querySelector(`.grid-cell[data-index="${n}"]`).style.backgroundImage==="")return!1}return!0}function j(e,t){for(let o=0;o<t;o++){const n=o*t+e;if(document.querySelector(`.grid-cell[data-index="${n}"]`).style.backgroundImage==="")return!1}return!0}function z(e,t){for(let o=0;o<t;o++){const n=e*t+o,c=document.querySelector(`.grid-cell[data-index="${n}"]`);c.style.backgroundImage="",c.style.filter=""}}function Z(e,t){for(let o=0;o<t;o++){const n=o*t+e,c=document.querySelector(`.grid-cell[data-index="${n}"]`);c.style.backgroundImage="",c.style.filter=""}}function Q(e,t){let o=0;e>0&&t>0?o=10:o=e+t,C+=o;const n=document.getElementById("score");n?n.textContent=`Score: ${C}`:console.error("Score element not found")}function V(){document.querySelectorAll(".grid-cell").forEach(c=>{c.style.backgroundImage="",c.style.filter="",c.classList.remove("preview")}),C=0;const t=document.getElementById("score");t&&(t.textContent="Score: 0");const o=document.getElementById("tetris-bank");o.innerHTML="",I(),l&&(l.remove(),l=null),document.querySelectorAll(".tetris-piece").forEach(c=>{c.style.opacity="1"}),document.draggedPiece&&(document.draggedPiece=null),I(),h()}function _(){A(),I(),W();const e=document.createElement("div");e.id="score",e.textContent="Score: 0",document.getElementById("app").insertBefore(e,document.getElementById("game-container")),document.getElementById("reset-button").addEventListener("click",o=>{console.log("click"),o.preventDefault(),V(),o.dataTransfer&&(o.dataTransfer.dropEffect="none",o.dataTransfer.effectAllowed="none")})}function B(){l&&(l.remove(),l=null),document.querySelectorAll(".tetris-piece").forEach(t=>{t.classList.remove("dragging")})}function ee(e){for(let o=0;o<5;o++)for(let n=0;n<5;n++){const c=o*5+n;if(S(e,c,5))return!0}return!1}function h(){document.querySelectorAll(".tetris-piece").forEach(t=>{const o=JSON.parse(t.dataset.shape),n=ee(o);t.classList.toggle("unplaceable",!n),t.draggable=n})}function M(e){const t=document.getElementById(e);t&&t.classList.remove("dragging")}function te(e,t,o,n){const c=Math.floor(o/n),r=Math.floor(t/n);if(e[c]&&e[c][r])return[c,r];const s=e.length,a=e[0].length;let i=1/0,f=[0,0];for(let d=0;d<s;d++)for(let m=0;m<a;m++)if(e[d][m]){const u=Math.sqrt(Math.pow(d-c,2)+Math.pow(m-r,2));u<i&&(i=u,f=[d,m])}return f}document.addEventListener("DOMContentLoaded",_);
