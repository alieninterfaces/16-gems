var F=Object.defineProperty;var K=(t,e,n)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>K(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const T={I:{shape:[[1,1,1,1]],color:"#00f0f0"},L:{shape:[[1,0],[1,0],[1,1]],color:"#c54155"},J:{shape:[[0,1],[0,1],[1,1]],color:"#c54155"},T:{shape:[[1,1,1],[0,1,0]],color:"#a000f0"},O:{shape:[[1,1],[1,1]],color:"#ae59b3"},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000"},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000"},Single:{shape:[[1]],color:"#f0a0f0"},Plus:{shape:[[0,1,0],[1,1,1],[0,1,0]],color:"#a0a0a0"},U:{shape:[[1,0,1],[1,1,1]],color:"#7bac3c"},BigSquare:{shape:[[1,1,1],[1,1,1],[1,1,1]],color:"#9e4b1e"},Two:{shape:[[1,1]],color:"#3c77b9"}};function A(){const t=Object.keys(T),e=t[Math.floor(Math.random()*t.length)];return{key:e,piece:T[e]}}function N(t){const e=document.getElementById("tetris-bank"),n=A();return t.remove(),Y(n.key,n.piece,e),E(),n}const a=8,Z=3,v=139,G=100;function z(t){return t.length,t[0].map((n,r)=>t.map(o=>o[r]).reverse())}function k(t){const e=j(t),n=Q(e.r,e.g,e.b);return Math.round(n[0]*360)}function j(t){t=t.replace(/^#/,"");const e=parseInt(t,16),n=e>>16&255,r=e>>8&255,o=e&255;return{r:n,g:r,b:o}}function Q(t,e,n){t/=255,e/=255,n/=255;const r=Math.max(t,e,n),o=Math.min(t,e,n);let c,l,i=(r+o)/2;if(r===o)c=l=0;else{const s=r-o;switch(l=i>.5?s/(2-r-o):s/(r+o),r){case t:c=(e-n)/s+(e<n?6:0);break;case e:c=(n-t)/s+2;break;case n:c=(t-e)/s+4;break}c/=6}return[c,l,i]}function V(t,e,n,r){const o=Math.floor(n/r),c=Math.floor(e/r);if(t[o]&&t[o][c])return[o,c];const l=t.length,i=t[0].length;let s=1/0,f=[0,0];for(let d=0;d<l;d++)for(let g=0;g<i;g++)if(t[d][g]){const m=Math.sqrt(Math.pow(d-o,2)+Math.pow(g-c,2));m<s&&(s=m,f=[d,g])}return f}function _(t){return document.querySelector(`.grid-cell[data-index="${t}"]`)}function ee(t,e,n){const r=_(t);if(r)if(r.style.backgroundImage=e?`url("${e}")`:"",r.style.backgroundSize="cover",n){const o=k(n);r.style.filter=`hue-rotate(${o}deg)`}else r.style.filter=""}function J(t,e,n,r,o){const c=n.width/a,l=Math.floor((t-n.left)/c)-o,i=Math.floor((e-n.top)/c)-r,s=i*a+l;return{targetCol:l,targetRow:i,targetIndex:s}}function te(t,e,n){const r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3),document.cookie=`${t}=${e};expires=${r.toUTCString()};path=/`}function ne(t){const e=t+"=",n=document.cookie.split(";");for(let r=0;r<n.length;r++){let o=n[r];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(e)===0)return o.substring(e.length,o.length)}return null}class B{constructor(e,n,r,o){p(this,"x");p(this,"y");p(this,"w");p(this,"h");p(this,"_sprite");p(this,"_body");console.log("Creating block",e,n,r,o),this.x=e,this.y=n,this.w=r,this.h=o,this.createSprite()}createSprite(){const e=["#848484","#c1c1c1","#aaaaaa"];this._sprite=document.createElement("canvas"),this._sprite.width=this.w,this._sprite.height=this.h;const n=this._sprite.getContext("2d");let r=2+Math.floor(Math.random()*4);for(let o=0;o<r;o++){let c=e[o%3],l=30+Math.random()*10,i=this.w-o*l,s=this.h-o*l;if(i<10||s<10)return;let f=(this.w-i)/2,d=(this.h-s)/2;n.fillStyle=c,n.beginPath(),n.roundRect(f,d,i,s,30),n.fill()}}get sprite(){return this._sprite.toDataURL()}}function S(t,e){const n=Math.floor(e/a),r=e%a;for(let o=0;o<t.length;o++)for(let c=0;c<t[o].length;c++)if(t[o][c]){const l=n+o,i=r+c;if(l>=a||i>=a||l<0||i<0)return!1;const s=l*a+i,f=_(s);if(!f||f.style.backgroundImage!=="")return!1}return!0}function O(t,e,n){const r=Math.floor(e/a),o=e%a;for(let c=0;c<t.length;c++)for(let l=0;l<t[c].length;l++)if(t[c][l]){const i=(r+c)*a+(o+l),s=new B(0,0,v,v).sprite;ee(i,s,n)}oe()}function oe(){let t=[],e=[];for(let n=0;n<a;n++)ce(n,a)&&t.push(n),re(n,a)&&e.push(n);t.forEach(n=>le(n,a)),e.forEach(n=>ie(n,a)),ge(t.length,e.length)}function ce(t,e){for(let n=0;n<e;n++){const r=t*e+n;if(document.querySelector(`.grid-cell[data-index="${r}"]`).style.backgroundImage==="")return!1}return!0}function re(t,e){for(let n=0;n<e;n++){const r=n*e+t;if(document.querySelector(`.grid-cell[data-index="${r}"]`).style.backgroundImage==="")return!1}return!0}function le(t,e){for(let n=0;n<e;n++){const r=t*e+n,o=document.querySelector(`.grid-cell[data-index="${r}"]`);o.style.backgroundImage="",o.style.filter=""}}function ie(t,e){for(let n=0;n<e;n++){const r=n*e+t,o=document.querySelector(`.grid-cell[data-index="${r}"]`);o.style.backgroundImage="",o.style.filter=""}}function se(){document.querySelectorAll(".grid-cell").forEach(e=>{e.style.backgroundImage="",e.style.filter="",e.classList.remove("preview")}),me(),X(),E()}function ae(t){t.preventDefault(),se(),t.dataTransfer&&(t.dataTransfer.dropEffect="none",t.dataTransfer.effectAllowed="none")}let w=0,P=parseInt(ne("highScore"))||0;function de(){const t=document.getElementById("game-grid");for(let e=0;e<a*a;e++){const n=document.createElement("div");n.className="grid-cell",n.dataset.index=e,t.appendChild(n)}}function X(){const t=document.getElementById("tetris-bank");t.innerHTML="";for(let e=0;e<Z;e++){const n=A();Y(n.key,n.piece,t)}E()}function Y(t,e,n){const r=document.createElement("div");r.className="tetris-piece",r.id=`piece-${t}-${Date.now()}`;const o=document.createElement("div");o.className="piece-grid";let c=JSON.parse(JSON.stringify(e.shape));const l=Math.floor(Math.random()*4);for(let i=0;i<l;i++)c=z(c);r.dataset.shape=JSON.stringify(c),r.dataset.color=e.color,fe(o,c,e.color),r.appendChild(o),n.appendChild(r),r.setAttribute("draggable",!0)}function E(){document.querySelectorAll(".tetris-piece").forEach(e=>{const n=JSON.parse(e.dataset.shape),r=ue(n);e.classList.toggle("unplaceable",!r),e.draggable=r})}function ue(t){for(let e=0;e<a;e++)for(let n=0;n<a;n++){const r=e*a+n;if(S(t,r))return!0}return!1}function fe(t,e,n){t.innerHTML="",t.style.display="grid",t.style.gridTemplateRows=`repeat(${e.length}, 10px)`,t.style.gridTemplateColumns=`repeat(${e[0].length}, 10px)`,e.forEach(r=>{r.forEach(o=>{const c=document.createElement("div");if(c.className="piece-cell",o){const l=new B(0,0,v,v).sprite;c.style.backgroundImage=`url("${l}")`,c.style.backgroundSize="cover";const i=k(n);c.style.filter=`hue-rotate(${i}deg)`}t.appendChild(c)})})}function ge(t,e){const n=t+e,r=n*(n>1?10:1);w+=r,w>P&&(P=w,te("highScore",P,365)),$()}function $(){const t=document.getElementById("score"),e=document.getElementById("high-score");t.textContent=`Score: ${w}`,e.textContent=`High Score: ${P}`}function he(){w=0,$()}function me(){w=0,$()}function pe(){de(),X()}let u=null,x=0,L=0;function ye(){document.removeEventListener("mousedown",C),document.removeEventListener("touchstart",C),document.removeEventListener("mousemove",I),document.removeEventListener("touchmove",I),document.removeEventListener("mouseup",b),document.removeEventListener("touchend",b),document.addEventListener("mousedown",C),document.addEventListener("touchstart",C),document.addEventListener("mousemove",I),document.addEventListener("touchmove",I),document.addEventListener("mouseup",b),document.addEventListener("touchend",b)}function C(t){const e=t.target.closest(".tetris-piece");if(!e||e.classList.contains("unplaceable"))return;t.preventDefault();const n=JSON.parse(e.dataset.shape),r=e.getBoundingClientRect();let o=t.clientX||t.touches[0].clientX,c=t.clientY||t.touches[0].clientY;c-=G;const l=r.width/2,i=r.height/2,s=r.width/n[0].length,[f,d]=V(n,l,i,s);u=we(n,e.dataset.color,f,d,e.id),document.body.appendChild(u),H(o,c,f,d,s)}function I(t){if(!u)return;t.preventDefault();let e=t.clientX||t.touches[0].clientX,n=t.clientY||t.touches[0].clientY;n-=G,x=e,L=n;const r=document.querySelector(".grid-cell").offsetWidth,o=parseInt(u.dataset.activeRow||0),c=parseInt(u.dataset.activeCol||0);H(e,n,o,c,r),Ee(e,n)}function b(t){if(!u||t.target.nodeName==="BUTTON")return;t.preventDefault();let e=x||t.clientX||t.changedTouches[0].clientX,n=L||t.clientY||t.changedTouches[0].clientY;const o=document.getElementById("game-grid-container").getBoundingClientRect(),c=u.dataset.originalId,l=JSON.parse(u.dataset.shape),i=parseInt(u.dataset.activeRow),s=parseInt(u.dataset.activeCol);if(x=null,L=null,e<o.left||e>o.right||n<o.top||n>o.bottom){q(c),D(),R();return}const{targetIndex:f}=J(e,n,o,i,s);if(S(l,f)){const d=u.dataset.color;O(l,f,d),N(document.getElementById(c)),E()}else{const d=U(l,Math.floor(f/a),f%a);if(d){const{row:g,col:m}=d,h=g*a+m,y=u.dataset.color;O(l,h,y),N(document.getElementById(c)),E()}else q(c)}D(),R()}function we(t,e,n,r,o){const c=document.createElement("div");c.className="dragged-piece",c.style.position="fixed",c.style.pointerEvents="none",c.style.zIndex="1000",c.style.opacity="0.8";const l=document.querySelector(".grid-cell").offsetWidth;c.style.width=`${t[0].length*l}px`,c.style.height=`${t.length*l}px`;const i=ve(t,e);return c.appendChild(i),c.dataset.shape=JSON.stringify(t),c.dataset.activeRow=n,c.dataset.activeCol=r,c.dataset.originalId=o,c.dataset.color=e,c}function ve(t,e){const n=document.createElement("div");return n.style.display="grid",n.style.width="100%",n.style.height="100%",n.style.gridTemplateColumns=`repeat(${t[0].length}, 1fr)`,n.style.gridTemplateRows=`repeat(${t.length}, 1fr)`,t.forEach(r=>{r.forEach(o=>{const c=document.createElement("div"),l=new B(0,0,v,v).sprite;c.style.backgroundImage=o?`url("${l}")`:"none",c.style.backgroundSize="cover";const i=k(e);c.style.filter=`hue-rotate(${i}deg)`,n.appendChild(c)})}),n}function H(t,e,n,r,o){if(u){const c=JSON.parse(u.dataset.shape);c[0].length*o,c.length*o;const l=(r+.5)*o,i=(n+.5)*o;u.style.left=`${t-l}px`,u.style.top=`${e-i}px`}}function Ee(t,e){if(!u)return;const n=JSON.parse(u.dataset.shape),o=document.getElementById("game-grid-container").getBoundingClientRect();if(t<o.left||t>o.right||e<o.top||e>o.bottom){R();return}const c=parseInt(u.dataset.activeRow),l=parseInt(u.dataset.activeCol),{targetCol:i,targetRow:s,targetIndex:f}=J(t,e,o,c,l);if(R(),S(n,f)){for(let d=0;d<n.length;d++)for(let g=0;g<n[d].length;g++)if(n[d][g]){const m=(s+d)*a+(i+g),h=document.querySelector(`.grid-cell[data-index="${m}"]`);h&&h.classList.add("preview")}}else{const d=U(n,s,i);if(d){const{row:g,col:m}=d;for(let h=0;h<n.length;h++)for(let y=0;y<n[h].length;y++)if(n[h][y]){const W=(g+h)*a+(m+y),M=document.querySelector(`.grid-cell[data-index="${W}"]`);M&&M.classList.add("preview")}}}}function U(t,e,n){const r=Math.max(a-t.length,a-t[0].length);for(let o=1;o<=r;o++)for(let c=-o;c<=o;c++)for(let l=-o;l<=o;l++)if(Math.abs(c)===o||Math.abs(l)===o){const i=e+c,s=n+l,f=i*a+s;if(S(t,f))return{row:i,col:s}}return null}function R(){document.querySelectorAll(".grid-cell.preview").forEach(t=>{t.classList.remove("preview")})}function D(){u&&(u.remove(),u=null)}function q(t){const e=document.getElementById(t);e&&e.classList.remove("dragging")}function Ce(){pe(),he(),ye();const t=document.getElementById("app");let e=1;window.innerWidth<window.innerHeight?e=window.innerWidth/500:e=window.innerHeight/600,t.style.transform=`scale(${e})`,document.getElementById("reset-button").addEventListener("click",ae)}window.addEventListener("resize",()=>{const t=document.getElementById("app");let e=1;window.innerWidth<window.innerHeight?e=window.innerWidth/500:e=window.innerHeight/600,t.style.transform=`scale(${e})`});document.addEventListener("DOMContentLoaded",Ce);
